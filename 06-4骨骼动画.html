<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>three测试文件1</title>
		<style type="text/css">
			body{
				margin:0;
				padding: 0;
				overflow: hidden;
			}
		</style>
		<script src="http://www.yanhuangxueyuan.com/versions/threejsR92/build/three.js"></script>
		<script src="http://www.yanhuangxueyuan.com/threejs/examples/js/controls/OrbitControls.js"></script>
	</head>
	<body>
		<script type="text/javascript">
			var scene=new THREE.Scene(); //创建场景对象
			// console.log('打印场景API',THREE.Scene);
			console.log(scene)
			
			//创建模型
			// var geometry=new THREE.BoxGeometry(100,100,100);//创建一个立方体几何对象BoxGeometry
			// var geometry = new THREE.SphereGeometry(60, 40, 40); //球体
            
			
			
			// 创建一个圆柱几何体，高度120，顶点坐标y分量范围[-60,60]
			var geometry = new THREE.CylinderGeometry(5, 10, 120, 50, 300);
			
			geometry.translate(0, 60, 0); //平移后，y分量范围[0,120]
			console.log("name", geometry.vertices); 
			
			// 设置几何体对象Geometry的蒙皮索引skinIndices、权重skinWeights属性
			//  实现一个模拟腿部骨骼运动的效果
			
			//遍历几何体顶点，为每一个顶点设置蒙皮索引、权重属性
			for(var i=0;i<geometry.vertices.length;i++){
				var vertex =geometry.vertices[i]//第i个顶点
				if(vertex.y<=60){
					geometry.skinIndices.push(new THREE.Vector4(0,0,0,0))
					geometry.skinWeights.push(new THREE.Vector4(1 - vertex.y / 60, 0, 0, 0))
				}else if(60 + 40 < vertex.y && vertex.y <= 60 + 40 + 20){
					// Vector4(2, 0, 0, 0)表示对应顶点受关节Bone3影响
					geometry.skinIndices.push(new THREE.Vector4(2, 0, 0, 0));
					// 影响该顶点关节Bone3对应权重是1-(vertex.y-100)/20
					geometry.skinWeights.push(new THREE.Vector4(1 - (vertex.y - 100) / 20, 0, 0, 0));
				}
			}
			// 材质对象
			var material = new THREE.MeshPhongMaterial({
			  skinning: true, //允许蒙皮动画
			  // wireframe:true,
			});
			
			//创建骨骼网格模型
			var SkinnedMesh=new THREE.SkinnedMesh(geometry,material)
			SkinnedMesh.position.set(50,120,50)
			SkinnedMesh.rotateX(Math.PI)
			scene.add(SkinnedMesh)
			
			//  骨骼系统
			var Bone1 = new THREE.Bone(); //关节1，用来作为根关节
			var Bone2 = new THREE.Bone(); //关节2
			var Bone3 = new THREE.Bone(); //关节3
			
			Bone1.add(Bone2);
			Bone2.add(Bone3);
			Bone2.position.y = 60; //Bone2相对父对象Bone1位置
			Bone3.position.y = 40; //Bone3相对父对象Bone2位置
			
			var skeleton = new THREE.Skeleton([Bone1, Bone2, Bone3]); //创建骨骼系统
			
			//骨骼网格模型SkinnedMesh
			SkinnedMesh.add(Bone1)//根骨头关节添加到网格模型
			SkinnedMesh.bind(skeleton) //网格模型绑定到骨骼系统
			console.log(SkinnedMesh);
			
			//骨骼辅助显示
			var skeletonHelper = new THREE.SkeletonHelper(SkinnedMesh);
			scene.add(skeletonHelper);
			
			// 转动关节带动骨骼网格模型出现弯曲效果  好像腿弯曲一样
			skeleton.bones[1].rotation.x = 0.5;
			skeleton.bones[2].rotation.x = 0.5;
			
			// var material=new THREE.MeshLambertMaterial({ //材质对象
			// 	color: 0x0000ff
			// });
			// var mesh=new THREE.Mesh(geometry,material);//模型对象
			// scene.add(mesh);//将模型添加到场景中去
			
			// var Bone1=new THREE.Bone()//关节1用来做根关节
			// var Bone2=new THREE.Bone()
			// var Bone3=new THREE.Bone()
			
			// //设置关节父子关系，多个骨头关节构成一个树结构
			// Bone1.add(Bone2)
			// Bone2.add(Bone3)
			// //设置关节之间的相对位置
			// //根关节Bone1默认位置是（0,0,0)
			// Bone2.position.y=60
			// Bone3.position.y=40 //相对父关节的位置
			
			// //骨架skeleton 可以吧所以骨关节对象bone包含进来
			// var skeleton=new THREE.Skeleton([Bone1,Bone2,Bone3]) //创建骨骼系统
			// console.log(skeleton)
			// //返回所以关节的世界坐标
			// skeleton.bones.forEach(elem=>{
			// 	console.log(elem.getWorldPosition(new THREE.Vector3()))
			// })
		
			
			
			
			//光源设置
			var point=new THREE.PointLight(0xffffff);
			point.position.set(400,200,300);//光源位置
			scene.add(point);//将光源添加到场景中去
			
			//环境光  依次还有 点光源 平行光 
			var ambient=new THREE.AmbientLight(0x444444);
			scene.add(ambient);
			
			//相机设置
			var width=window.innerWidth;//窗口宽度
			var height=window.innerHeight;//窗口高度
			var k=width/height ;//宽高比
			var s=200;//3d范围控制系数
			
			//创建相机对象
			var camera=new THREE.OrthographicCamera(-s * k, s * k, s, -s, 1, 1000);
			camera.position.set(200,300,200);//设置相机位置
			camera.lookAt(scene.position);//定义相机的位置与方向 即指向的场景对象
			
			//创建渲染器对象
			var renderer =new THREE.WebGLRenderer();
			renderer.setSize(width,height);//设置渲染区域尺寸
			renderer.setClearColor(0xb9d3ff,1);//设置背景颜色
			document.body.appendChild(renderer.domElement);//body元素中插入canvas对象
			//执行渲染操作  指定场景 相机作为参数
			// renderer.render(scene, camera);
			
			
			var n = 0;
			var T = 50;
			var step = 0.01;
			
			//鼠标操作
			function render() {
			    renderer.render(scene,camera);//执行渲染操作
			    requestAnimationFrame(render);
			    n += 1;
			    if(n<T){
				  skeleton.bones[0].rotation.x=  skeleton.bones[0].rotation.x - step;
				  skeleton.bones[1].rotation.x = skeleton.bones[1].rotation.x + step;
				  skeleton.bones[2].rotation.x = skeleton.bones[2].rotation.x + 2 * step;
			    }
			    if (n < 2 * T && n > T) {
			      skeleton.bones[0].rotation.x = skeleton.bones[0].rotation.x + step;
			      skeleton.bones[1].rotation.x = skeleton.bones[1].rotation.x - step;
			      skeleton.bones[2].rotation.x = skeleton.bones[2].rotation.x - 2 * step;
			    }
			    if (n === 2 * T) {
				  n = 0;
			    }
			}
			render();
			var controls = new THREE.OrbitControls(camera,renderer.domElement);//创建控件对象
			controls.addEventListener('change', render);//监听鼠标、键盘事件
			 
			
			
			
			
		</script>
	</body>
</html>

